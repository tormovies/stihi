# Оптимизация: загрузка, производительность, SEO

**Реализовано (по списку):** eager load автора для стиха, canonical, robots.txt с Sitemap, preload шрифта, версионирование CSS, Open Graph, кэш главной со сбросом при изменениях, JSON-LD для стиха и автора; Gzip-сжатие ответов (middleware), минификация CSS (команда `php artisan css:minify`), использование site.min.css при наличии, Cache-Control для статики в .htaccess.

---

## 1. Загрузка и фронтенд

### Уже хорошо
- Один CSS-файл, без тяжёлого JS-фреймворка на публичном сайте.
- Шрифты: `font-display: swap`, woff2, разбивка по unicode-range.
- Минимум скриптов (только переключение темы inline).

### Что можно сделать

| Что | Зачем |
|-----|--------|
| **Версионирование CSS** | `asset('css/site.css?v=' . filemtime(public_path('css/site.css')))` или хэш в имени файла — после изменений браузер подтянет новый файл, при этом можно кэшировать надолго. |
| **Preload шрифтов** | В `<head>` добавить `<link rel="preload" href="/fonts/literata/literata-400-cyrillic.woff2" as="font" type="font/woff2" crossorigin>` для основного начертания (кириллица) — быстрее первый рендер текста. |
| **Сжатие на сервере** | Включить gzip/brotli для HTML, CSS, шрифтов в Nginx/Apache или через Laravel middleware — меньше трафика и быстрее загрузка. |
| **Минификация CSS** | Реализовано: команда `php artisan css:minify` создаёт `public/css/site.min.css`; layout подключает его, если файл есть. После правок `site.css` запускайте команду заново. |

---

## 2. Производительность (бэкенд)

### Потенциальные проблемы

| Где | Проблема | Решение |
|-----|----------|---------|
| **SlugController (страница стиха)** | При показе стиха вызывается `$poem->author` — отдельный запрос (lazy load). | Загружать стих с автором: `Poem::with('author')->where('slug', $slug)->whereNotNull('published_at')->firstOrFail()`. |
| **Главная** | Каждый запрос: Page, SeoTemplate, все авторы. | При желании кэшировать результат на 5–15 минут: `Cache::remember('home_view', 600, fn() => ...)` и сбрасывать кэш при изменении страницы/авторов/SEO. |
| **Sitemap** | Уже кэшируется на 7 дней — ок. | — |

### Уже хорошо
- Sitemap кэшируется (Cache).
- Нет N+1 на списках: у автора подгружаются только стихи пагинацией, на главной — только авторы.
- Пагинация по стихам (50 на страницу).

---

## 3. SEO-оптимизация

### Уже есть
- Уникальные `title` и `meta description` по страницам (шаблоны + переопределения).
- H1 и описание под H1.
- Sitemap: `/sitemap.xml`.
- `robots.txt` не закрывает индексацию.
- Осмысленные URL (slug автора, стиха, страницы).

### Что добавить

| Что | Зачем |
|-----|--------|
| **Canonical URL** | В `<head>` каждой страницы: `<link rel="canonical" href="{{ url()->current() }}">` — избежать дублей при разных вариантах URL (с/без слэша, параметров). |
| **Указание sitemap в robots.txt** | Строка `Sitemap: https://ваш-домен.ru/sitemap.xml` — поисковики быстрее найдут карту. |
| **Open Graph** | Мета-теги `og:title`, `og:description`, `og:url`, `og:type` — корректный предпросмотр в соцсетях и мессенджерах. |
| **Схема Article/CreativeWork (JSON-LD)** | На странице стиха — тип CreativeWork, автор, название; на странице автора — Person. Необязательно, но улучшает сниппеты. |
| **Читаемые URL со слэшем** | Сейчас маршрут `/{slug}`. Если в конфиге/сервере итоговый URL со слэшем в конце — держать единый формат везде (редиректы с без слэша на со слэшем). |

---

## 4. Сервер и кэширование ответов

| Что | Рекомендация |
|-----|--------------|
| **Статика (CSS, шрифты)** | Реализовано: в `public/.htaccess` для расширений css, woff2, ico и т.д. выставлен `Cache-Control: public, max-age=31536000`. Версионирование через `?v=filemtime` в layout. При использовании Nginx добавьте аналогичные заголовки в конфиг location для статики. |
| **HTML страниц** | Не кэшируем (по умолчанию); главная кэшируется в Laravel на 10 минут. |
| **Сжатие** | Реализовано: middleware `GzipResponse` сжимает text/html, text/css, application/json и т.д. при наличии заголовка Accept-Encoding: gzip. |

---

## 5. Приоритет внедрения

**Быстро и полезно:**
1. Eager load `author` при показе стиха (SlugController).
2. Canonical в layout сайта.
3. В `robots.txt` добавить `Sitemap: ...`.

**Средний приоритет:**
4. Preload основного шрифта (кириллица).
5. Версионирование CSS (или хэш в имени при сборке).
6. Open Graph для страниц стихов/авторов/главной.

**По желанию:**
7. Кэш главной страницы.
8. Минификация CSS для production.
9. JSON-LD разметка для стихов/авторов.
